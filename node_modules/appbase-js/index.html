<!DOCTYPE html>
<html>
<head>
	<script type="text/javascript" src="browser/appbase.js"></script>
	<script type="text/javascript">
	var i = 0;
	(function test() {
		var streamingClient = new Appbase({
			url: 'https://RIvfxo1u1:dee8ee52-8b75-4b5b-be4f-9df3c364f59f@scalr.api.appbase.io',
			appname: 'createnewtestapp01'
		})
		var response = streamingClient.streamSearch({
			type: 'books',
			body: {
				query: {
					match_all: {}
				}
			}
		})
		response.stop()
		response = streamingClient.streamSearch({
			type: 'books',
			body: {
				query: {
					match_all: {}
				}
			}
		})
		var first = true
		response.on('data', function(data) {
			if(first) {
				first = false
			} else {
				console.log('done', i, data)
				response.stop()
			}
		})
		setTimeout(function() {
			streamingClient.index({
				type: 'books',
				id: '1',
				body: {"foo": ++i }
			}).on('data', test)
			console.log('start', i)
		}, 3000)
	})()
	</script>
</head>
<body>

</body>
</html>